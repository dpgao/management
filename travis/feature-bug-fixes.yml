notifications:
  email:
    recipients:
      - rich@flatcap.org
    on_success: change
    on_failure: always

sudo: required
dist: trusty

language: c
compiler: gcc
cache: ccache

before_script:
  - ccache -z
  - autoreconf -i

script:
  # Clumsy way to forcibly disable options
  - ./configure && grep -v HAVE_FGETC_UNLOCKED     config.h > config.h.tmp && mv config.h.tmp config.h && make && ./mutt -v
  - ./configure && grep -v HAVE_USE_EXTENDED_NAMES config.h > config.h.tmp && mv config.h.tmp config.h && make && ./mutt -v
  - ./configure && grep -v HAVE_STRNDUP            config.h > config.h.tmp && mv config.h.tmp config.h && make && ./mutt -v
  - ./configure && grep -v HAVE_STRNLEN            config.h > config.h.tmp && mv config.h.tmp config.h && make && ./mutt -v
  - ./configure && make && ./mutt -v

after_script:
  - ccache -s

